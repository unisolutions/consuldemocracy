<% if @heading.present? %>
  <section class="no-margin-top margin-bottom">
    <div class="expanded jumbo-budget budget-heading padding">

      <div class="row">
        <div class="small-12 column">
          <%= back_link_to budget_path(@budget) %>

          <% if can? :show, @ballot %>
            <%= link_to t("budgets.investments.header.check_ballot"),
                        budget_ballot_path(@budget),
                        class: "check-ballot button" %>
          <% end %>
        </div>
      </div>

      <div class="row progress-votes">
        <div class="small-12 column">
          <% if can? :show, @ballot %>
            <div id="check-ballot" style="display: none;">
              <%= link_to t("budgets.investments.header.check_ballot"),
                          budget_ballot_path(@budget) %>
            </div>
            <br>


            <div class="group-headings-container">
              <% @budget.groups.order(:id).each do |group| %>
                <div class="group-container">
                  <%= link_to group.name, "#", class: "group-button button", data: { group_id: group.id }, style: "background-color: darkblue; color: white;" %>
                  <div class="headings-container" id="group_<%= group.id %>_headings" style="display: none;">
                    <% group.headings.order(:id).each do |heading| %>
                      <%= link_to "#{heading.name}", budget_investments_path(@budget, heading_id: heading.id), class: "heading-button button" %>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>


            <!--    <%# @budget.groups.order(:id).each do |group| %>
              <%#= group.name %>
            <%# end %>

            <%# @budget.groups.first.headings.order(:id).each do |group| %>
              <%#= group.name %>
            <%# end %>-->
            <!-- <%# @budget.headings.order(:id).each do |heading| %>
              <%# group_name = heading.group.name %>
              <%#= link_to "#{group_name}: #{heading.name} ", budget_investments_path(@budget, heading_id: heading.id), class: "button" %>
            <%# end %>
-->

            <% if @ballot.valid_heading?(@heading) %>
              <div class="progress-bar-nav" data-fixed-bar>
                <h2>
                  <%= t("budgets.investments.index.by_heading", heading: @heading.name) %>
                </h2>

                <div id="progress_bar">
                  <%= render "budgets/ballot/progress_bar", ballot: @ballot, heading: @heading %>
                </div>

              </div>
            <% else %>
              <h2>
                <%= t("budgets.investments.index.by_heading", heading: @heading.name) %>
              </h2>
              <div class="small-12 medium-9">
                <div class="callout warning margin-top">
                  <%= sanitize(t("budgets.investments.header.different_heading_assigned",
                                 heading_link: heading_link(@assigned_heading, @budget))) %>
                  <br>
                  <small>
                    <%= sanitize(t("budgets.investments.header.change_ballot",
                                   check_ballot: link_to(t("budgets.investments.header.check_ballot_link"),
                                                         budget_ballot_path(@budget)))) %>
                  </small>
                </div>
              </div>
            <% end %>
          <% else %>
            <h2 class="margin-top">
              <%= t("budgets.investments.index.by_heading", heading: @heading.name) %>
            </h2>
            <% if @budget.show_money? %>
              <h3>
                <span class="tagline"><%= t("budgets.investments.header.price") %></span>
                <%= @budget.formatted_heading_price(@heading) %>
              </h3>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </section>
<% else %>
  <div class="expanded jumbo-budget padding no-margin-top margin-bottom">
    <div class="row">
      <div class="small-12 column">
        <%= back_link_to budget_path(@budget) %>

        <h2 class="margin-top">
          <%= t("budgets.investments.index.title") %>
        </h2>
      </div>
    </div>
  </div>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Function to toggle visibility of heading containers
    function toggleHeadingVisibility(groupId) {
      var selectedHeadingsContainer = document.getElementById("group_" + groupId + "_headings");
      var isCurrentlyVisible = selectedHeadingsContainer.style.display === "block";

      // Store the current scroll position
      var scrollPosition = window.pageYOffset;

      // Toggle visibility of the headings container only if it's currently hidden
      if (!isCurrentlyVisible) {
        selectedHeadingsContainer.style.display = "block";

        // Hide all other headings containers
        document.querySelectorAll(".headings-container").forEach(function(container) {
          if (container.id !== "group_" + groupId + "_headings") {
            container.style.display = "none";
          }
        });
      }

      // Restore the scroll position after toggling visibility
      window.scrollTo(0, scrollPosition);
    }

    // Add event listener to the document for handling click events on group buttons
    document.addEventListener("click", function(event) {
      var target = event.target;

      // Check if the clicked element is a group button
      if (target.matches(".group-button")) {
        var groupId = target.dataset.groupId;
        toggleHeadingVisibility(groupId);
      }

      // Prevent click events on heading buttons from bubbling up to parent elements
      if (target.matches(".heading-button")) {
        event.stopPropagation();
      }
    });

    // Check URL parameters for heading ID and show corresponding headings container
    var urlParams = new URLSearchParams(window.location.search);
    var headingId = urlParams.get("heading_id");
    if (headingId) {
      var groupButton = document.querySelector(".group-button[data-group-id='" + headingId + "']");
      if (groupButton) {
        toggleHeadingVisibility(headingId);
      }
    }
  });
</script>








